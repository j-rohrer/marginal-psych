<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models as Prediction Machines – deskmates</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Models as Prediction Machines</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assets/models_as_prediction_machines.zip" rel="" target="">
 <span class="menu-text">Replication package as ZIP</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-examples" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Examples</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-examples">    
        <li>
    <a class="dropdown-item" href="../examples/soep.html" rel="" target="">
 <span class="dropdown-text">Illustrating target quantities</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../examples/relationship.html" rel="" target="">
 <span class="dropdown-text">Worked Example 1: Relationship Status and Friends</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../examples/deskmates.html" rel="" target="">
 <span class="dropdown-text">Worked Example 2: Friends by Chance</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#friends-by-chance" id="toc-friends-by-chance" class="nav-link active" data-scroll-target="#friends-by-chance">Friends by Chance</a>
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#read-and-clean-the-data" id="toc-read-and-clean-the-data" class="nav-link" data-scroll-target="#read-and-clean-the-data">Read and clean the data</a></li>
  <li><a href="#bayesian-multilevel-regression-model" id="toc-bayesian-multilevel-regression-model" class="nav-link" data-scroll-target="#bayesian-multilevel-regression-model">Bayesian multilevel regression model</a></li>
  <li><a href="#interpretation-with-marginaleffects" id="toc-interpretation-with-marginaleffects" class="nav-link" data-scroll-target="#interpretation-with-marginaleffects">Interpretation with <code>marginaleffects</code></a>
  <ul class="collapse">
  <li><a href="#what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-log-odds-of-a-friendship-link-scale" id="toc-what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-log-odds-of-a-friendship-link-scale" class="nav-link" data-scroll-target="#what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-log-odds-of-a-friendship-link-scale">What is the average treatment effect of being a deskmate on the log-odds of a friendship (link scale)?</a></li>
  <li><a href="#what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship" id="toc-what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship" class="nav-link" data-scroll-target="#what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship">What is the average treatment effect of being a deskmate on the probability of a friendship?</a></li>
  <li><a href="#comparing-our-effect-to-the-fast-friends-procedure" id="toc-comparing-our-effect-to-the-fast-friends-procedure" class="nav-link" data-scroll-target="#comparing-our-effect-to-the-fast-friends-procedure">Comparing our effect to the fast friends procedure</a></li>
  <li><a href="#what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship-at-desks-with-different-gender-compositions" id="toc-what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship-at-desks-with-different-gender-compositions" class="nav-link" data-scroll-target="#what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship-at-desks-with-different-gender-compositions">What is the average treatment effect of being a deskmate on the probability of a friendship, at desks with different gender compositions?</a>
  <ul class="collapse">
  <li><a href="#pairwise-comparisons-e.g.-is-the-effect-of-sharing-a-desk-stronger-for-students-on-girls-only-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks" id="toc-pairwise-comparisons-e.g.-is-the-effect-of-sharing-a-desk-stronger-for-students-on-girls-only-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks" class="nav-link" data-scroll-target="#pairwise-comparisons-e.g.-is-the-effect-of-sharing-a-desk-stronger-for-students-on-girls-only-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks">Pairwise comparisons, e.g.: Is the effect of sharing a desk stronger for students on girls-only desks, relative to the effect of sharing a desk for students on mixed-gender desks?</a></li>
  <li><a href="#is-the-effect-of-sharing-a-desk-stronger-for-students-on-gender-matched-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks" id="toc-is-the-effect-of-sharing-a-desk-stronger-for-students-on-gender-matched-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks" class="nav-link" data-scroll-target="#is-the-effect-of-sharing-a-desk-stronger-for-students-on-gender-matched-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks">Is the effect of sharing a desk stronger for students on gender-matched desks, relative to the effect of sharing a desk for students on mixed-gender desks?</a></li>
  <li><a href="#plotting-the-effects-by-gender" id="toc-plotting-the-effects-by-gender" class="nav-link" data-scroll-target="#plotting-the-effects-by-gender">Plotting the effects by gender</a></li>
  </ul></li>
  <li><a href="#averaging-over-vs.-conditioning-on-other-variables-in-the-model" id="toc-averaging-over-vs.-conditioning-on-other-variables-in-the-model" class="nav-link" data-scroll-target="#averaging-over-vs.-conditioning-on-other-variables-in-the-model">Averaging Over vs.&nbsp;Conditioning on Other Variables in the Model</a>
  <ul class="collapse">
  <li><a href="#what-is-the-average-treatment-effect-of-sharing-a-desk-for-students-with-high-and-low-differences-in-gpa-accounting-for-gender" id="toc-what-is-the-average-treatment-effect-of-sharing-a-desk-for-students-with-high-and-low-differences-in-gpa-accounting-for-gender" class="nav-link" data-scroll-target="#what-is-the-average-treatment-effect-of-sharing-a-desk-for-students-with-high-and-low-differences-in-gpa-accounting-for-gender">What is the average treatment effect of sharing a desk for students with high and low differences in GPA, accounting for gender?</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="friends-by-chance" class="level1">
<h1>Friends by Chance</h1>
<p>Before we start, let’s execute <a href="https://github.com/j-rohrer/marginal-psych/blob/main/scripts/load.R">a helper script</a> that loads the necessary dependencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"scripts/load.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This document contains example 3, in which we analyze the effect of being seated next to each other on friendships, using Bayesian multilevel models. Data can be downloaded from the <a href="https://osf.io/wt7nh" target="_blank">OSF</a> but are also included in the downloadable replication package.</p>
<p>Every day experience—and previous research—suggests that being spatially close to others can result in friendships. But does spatial proximity also lead to friendships for people who are quite different from each other? We re-analyze data from a large field experiment conducted in 3rd to 8th grade classrooms in rural Hungary previously reported in <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0255097" target="_blank">Rohrer et al.&nbsp;(2021)</a>. Proximity was experimentally manipulated by randomizing each classrooms’ seating chart at the beginning of the school semester; thus, students randomly ended up next to each other (deskmate = 1) or not (deskmate = 0). At the end of the semester, students listed up to five best friends from their classroom, which allows us to determine which pairs of students had formed friendships (friendship = 1). Additionally, we know students’ gender and grade point average before the experiment (GPA), which allows us to investigate whether proximity also “works” for girls seated next to boys (who are quite unlikely to befriend each other at that age) or students with discrepant levels of academic achievement.</p>
</section>
<section id="read-and-clean-the-data" class="level2">
<h2 class="anchored" data-anchor-id="read-and-clean-the-data">Read and clean the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/deskmates.csv"</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Arbitrary subset of 60 classes to make model-fitting less tedious</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>class_id <span class="sc">%in%</span> <span class="fu">unique</span>(dat<span class="sc">$</span>class_id)[<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>], ]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep complete cases</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[<span class="fu">complete.cases</span>(dat),]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Label focal variables</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">transform</span>(dat,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender_combination =</span> <span class="fu">factor</span>(girl_match, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Boys"</span>, <span class="st">"Mixed"</span>, <span class="st">"Girls"</span>)),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">deskmate =</span> <span class="fu">factor</span>(deskmate, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Different desk"</span>, <span class="st">"Same desk"</span>)))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename to match labels in manuscript</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GPA_average =</span> mean_gpa,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">GPA_difference =</span> diff_gpa,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">friendship =</span> friend,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">classroom =</span> class_id,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">student1 =</span> s1,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">student2 =</span> s2)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of data</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  any_single       deskmate sim_s1_s2 girl_s1 girl_s2 roma_s1 roma_s2 gpa_s1 gpa_s2 friendship friend_s1 friend_s2 girl_match roma_match GPA_average GPA_difference sim_s1_s2_std size size.1 gendermatch classroom school_id student1 student2 gender_combination
1          0      Same desk 0.6500000       1       0       0       0    4.4    4.2          0         0         0          1          0         4.3            0.2    -0.2570821   18     18           0     59379        32   731891   773914              Mixed
2          0 Different desk 0.9566667       1       1       0       0    4.4    5.0          1         1         1          2          0         4.7            0.6     1.0919846   18     18           1     59379        32   731891   492505              Girls
3          0 Different desk 0.6366667       1       0       0       0    4.4    4.0          0         0         0          1          0         4.2            0.4    -0.3157372   18     18           0     59379        32   731891   300996              Mixed
4          0 Different desk 0.6233333       1       0       0       0    4.4    4.2          0         0         0          1          0         4.3            0.2    -0.3743922   18     18           0     59379        32   731891   888954              Mixed
5          0 Different desk 0.9833333       1       1       0       0    4.4    4.6          1         1         1          2          0         4.5            0.2     1.2092947   18     18           1     59379        32   731891   706146              Girls
6          0 Different desk 0.6233333       1       0       0       0    4.4    5.0          0         0         0          1          0         4.7            0.6    -0.3743922   18     18           0     59379        32   731891   288809              Mixed</code></pre>
</div>
</div>
</section>
<section id="bayesian-multilevel-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-multilevel-regression-model">Bayesian multilevel regression model</h2>
<p>Our model here ends up a bit more complex due to the nested structure of the data, and we use the brms package <a href="https://journal.r-project.org/archive/2018/RJ-2018-017/RJ-2018-017.pdf" target="_blank">(Bürkner, 2018)</a> which allows us to fit multilevel models in a highly flexible manner. Since we now fit a Bayesian model (relying on the default priors provided by the package), marginaleffects will return credible intervals rather than confidence intervals. Our unit of observation is pairs of students, which are nested within students and classrooms. For each pair, we know: * whether they are deskmates * their gender_combination (both boys, one girl and one boy, both girls) * their GPA_average (i.e., the average across both students) and their absolute GPA_difference (i.e., the discrepancy between both students) * whether they report a friendship at the end of the experiment or not</p>
<p>Here, we fit and save the model to avoid refitting repeatedly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    friendship <span class="sc">~</span> deskmate <span class="sc">+</span> gender_combination <span class="sc">+</span> deskmate<span class="sc">:</span>gender_combination <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        GPA_average <span class="sc">+</span> GPA_difference <span class="sc">+</span> GPA_average<span class="sc">:</span>deskmate <span class="sc">+</span> GPA_difference<span class="sc">:</span>deskmate <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">1</span> <span class="sc">|</span> classroom) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> <span class="fu">mm</span>(student1, student2)),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">12345</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Save model fit</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(mod, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"fits/deskmates.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the fitted model</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"fits/deskmates.rds"</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the model coefficients</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter                                |   Median |         95% CI |     pd |  Rhat |     ESS
-----------------------------------------------------------------------------------------------
(Intercept)                              |    -1.62 | [-2.34, -0.94] |   100% | 1.000 | 1791.00
deskmateSamedesk                         |     0.22 | [-1.49,  1.96] | 60.02% | 1.001 | 2402.00
gender_combinationMixed                  |    -3.54 | [-3.88, -3.23] |   100% | 1.002 | 2582.00
gender_combinationGirls                  | 5.66e-03 | [-0.25,  0.25] | 51.75% | 1.001 | 2254.00
GPA_average                              |     0.30 | [ 0.13,  0.49] | 99.95% | 1.001 | 1495.00
GPA_difference                           |    -0.42 | [-0.56, -0.28] |   100% | 1.000 | 4267.00
deskmateSamedesk:gender_combinationMixed |     0.12 | [-0.86,  0.98] | 59.62% | 1.000 | 4483.00
deskmateSamedesk:gender_combinationGirls |     0.04 | [-0.69,  0.78] | 54.07% | 1.001 | 4559.00
deskmateSamedesk:GPA_average             |     0.18 | [-0.26,  0.62] | 79.67% | 1.000 | 2529.00
deskmateSamedesk:GPA_difference          |    -0.03 | [-0.60,  0.47] | 54.55% | 1.000 | 4436.00</code></pre>
</div>
</div>
</section>
<section id="interpretation-with-marginaleffects" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-with-marginaleffects">Interpretation with <code>marginaleffects</code></h2>
<section id="what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-log-odds-of-a-friendship-link-scale" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-log-odds-of-a-friendship-link-scale">What is the average treatment effect of being a deskmate on the log-odds of a friendship (link scale)?</h3>
<p>In principle, we could evaluate this model on the log-odds scale on which the coefficients are estimated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod, <span class="at">variables =</span> <span class="st">"deskmate"</span>, <span class="at">type =</span> <span class="st">"link"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<!-- preamble start -->

    <script>

      function styleCell_pm5u0j33rc7fjn65hrjk(i, j, css_id) {
          var table = document.getElementById("tinytable_pm5u0j33rc7fjn65hrjk");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_pm5u0j33rc7fjn65hrjk');
        // Find the row with data-row attribute matching i
        var targetRow = table.querySelector(`tr [data-row="${i}"]`).closest('tr');
        var newRow = table.insertRow(targetRow.rowIndex);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        newCell.setAttribute("data-col", "0");
        newCell.setAttribute("data-row", i - 1);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_pm5u0j33rc7fjn65hrjk(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_pm5u0j33rc7fjn65hrjk");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 },  ], css_id: 'tinytable_css_mpny3sck6tc4la0x498d',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_m1ceo3t32kxcr45hlfda',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_pm5u0j33rc7fjn65hrjk(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_mpny3sck6tc4la0x498d, .table th.tinytable_css_mpny3sck6tc4la0x498d { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_m1ceo3t32kxcr45hlfda, .table th.tinytable_css_m1ceo3t32kxcr45hlfda { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_pm5u0j33rc7fjn65hrjk" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Estimate</th>
                <th scope="col" data-row="0" data-col="1">2.5 %</th>
                <th scope="col" data-row="0" data-col="2">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">0.958</td>
                  <td data-row="1" data-col="1">0.533</td>
                  <td data-row="1" data-col="2">1.35</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>However, log-odds of friendship are not a particularly intuitive unit, and so instead we may want to switch to the scale of the outcome (friendships)—which is the default behavior of marginaleffects:</p>
</section>
<section id="what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship">What is the average treatment effect of being a deskmate on the probability of a friendship?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted probabilities</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_predictions</span>(mod, <span class="at">by =</span> <span class="st">"deskmate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<!-- preamble start -->

    <script>

      function styleCell_olwmujyzud76v4nr3m5t(i, j, css_id) {
          var table = document.getElementById("tinytable_olwmujyzud76v4nr3m5t");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_olwmujyzud76v4nr3m5t');
        // Find the row with data-row attribute matching i
        var targetRow = table.querySelector(`tr [data-row="${i}"]`).closest('tr');
        var newRow = table.insertRow(targetRow.rowIndex);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        newCell.setAttribute("data-col", "0");
        newCell.setAttribute("data-row", i - 1);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_olwmujyzud76v4nr3m5t(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_olwmujyzud76v4nr3m5t");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '2', j: 0 }, { i: '2', j: 1 }, { i: '2', j: 2 }, { i: '2', j: 3 },  ], css_id: 'tinytable_css_0qp5zecdjj8s8uior2o9',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 },  ], css_id: 'tinytable_css_tyb98h7vn673labxtom3',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_olwmujyzud76v4nr3m5t(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_0qp5zecdjj8s8uior2o9, .table th.tinytable_css_0qp5zecdjj8s8uior2o9 { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_tyb98h7vn673labxtom3, .table th.tinytable_css_tyb98h7vn673labxtom3 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_olwmujyzud76v4nr3m5t" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">deskmate</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">2.5 %</th>
                <th scope="col" data-row="0" data-col="3">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">Different desk</td>
                  <td data-row="1" data-col="1">0.166</td>
                  <td data-row="1" data-col="2">0.158</td>
                  <td data-row="1" data-col="3">0.174</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">Same desk</td>
                  <td data-row="2" data-col="1">0.270</td>
                  <td data-row="2" data-col="2">0.234</td>
                  <td data-row="2" data-col="3">0.311</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Average Treatment Effect</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ate <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod, <span class="at">variables =</span> <span class="st">"deskmate"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<!-- preamble start -->

    <script>

      function styleCell_3a6drqn3zf8vz9kou2xc(i, j, css_id) {
          var table = document.getElementById("tinytable_3a6drqn3zf8vz9kou2xc");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_3a6drqn3zf8vz9kou2xc');
        // Find the row with data-row attribute matching i
        var targetRow = table.querySelector(`tr [data-row="${i}"]`).closest('tr');
        var newRow = table.insertRow(targetRow.rowIndex);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        newCell.setAttribute("data-col", "0");
        newCell.setAttribute("data-row", i - 1);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_3a6drqn3zf8vz9kou2xc(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_3a6drqn3zf8vz9kou2xc");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 },  ], css_id: 'tinytable_css_98xhr0944mes30mhhr5g',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_q5w96y2y25r2di6dq9ck',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_3a6drqn3zf8vz9kou2xc(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_98xhr0944mes30mhhr5g, .table th.tinytable_css_98xhr0944mes30mhhr5g { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_q5w96y2y25r2di6dq9ck, .table th.tinytable_css_q5w96y2y25r2di6dq9ck { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_3a6drqn3zf8vz9kou2xc" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Estimate</th>
                <th scope="col" data-row="0" data-col="1">2.5 %</th>
                <th scope="col" data-row="0" data-col="2">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">0.108</td>
                  <td data-row="1" data-col="1">0.0697</td>
                  <td data-row="1" data-col="2">0.15</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>This returns the average effect of the intervention in percentage points.</p>
</section>
<section id="comparing-our-effect-to-the-fast-friends-procedure" class="level3">
<h3 class="anchored" data-anchor-id="comparing-our-effect-to-the-fast-friends-procedure">Comparing our effect to the fast friends procedure</h3>
<p>One may want to compare the effect of sitting next to each other to other interventions meant to foster friendships. For example, one staple of psychological research is the fast friends procedure in which two participants are paired up and then take turns answering questions that escalate in the degree of self-disclosure involved, from mild (“Would you like to be famous? In what way?”) to severe (“When did you last cry in front of another person?”). <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/jora.12622" target="_blank">Echols and Ivanich (2021)</a> implemented such a procedure in US middle school students and found that those who underwent the intervention in three sessions over three months were 10 percentage points more likely to become friends. This seems very close to the 11 percentage point effect we observed in our analysis.</p>
<p>Would it be justified to conclude that the effects are practically the same?</p>
<p>In a Frequentist framework, this would be a use case for an equivalence test. Given our Bayesian model, we instead resort to the notion of a region of practical equivalence (ROPE; <a href="https://journals.sagepub.com/doi/pdf/10.1177/2515245918771304" target="_blank">Kruschke, 2018</a>; <a href="https://www.frontiersin.org/journals/psychology/articles/10.3389/fpsyg.2019.02767/full" target="_blank">Makowski et al., 2019</a>. First, we need to define a range around the 10 percentage points of the fast friends procedure for which we would consider the effects equivalent for practical purposes. Here, we decide that the effect ± a quarter of the effect is a sensible range, resulting in a ROPE of [0.075; 0.125].</p>
<p>Now, we can calculate how likely it is that the effect of sitting next to each other falls into the ROPE of the fast friends procedure. For this, we additionally make use of the convenience provided by the posterior package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">get_draws</span>(<span class="fu">avg_comparisons</span>(mod, <span class="at">variables =</span> <span class="st">"deskmate"</span>), <span class="st">"rvar"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Pr</span>(draws<span class="sc">$</span>rvar <span class="sc">&lt;</span> <span class="fl">0.125</span>) <span class="co"># Probability that below the upper bound</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.79775</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Pr</span>(draws<span class="sc">$</span>rvar <span class="sc">&lt;</span> <span class="fl">0.075</span>) <span class="co"># Probability that below the lower bound</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04175</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In combination, from this we can conclude the probability that</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the parameter lies within the bounds</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Pr</span>(draws<span class="sc">$</span>rvar <span class="sc">&lt;</span> <span class="fl">0.125</span>) <span class="sc">-</span> <span class="fu">Pr</span>(draws<span class="sc">$</span>rvar <span class="sc">&lt;</span> <span class="fl">0.075</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.756</code></pre>
</div>
</div>
</section>
<section id="what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship-at-desks-with-different-gender-compositions" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-average-treatment-effect-of-being-a-deskmate-on-the-probability-of-a-friendship-at-desks-with-different-gender-compositions">What is the average treatment effect of being a deskmate on the probability of a friendship, at desks with different gender compositions?</h3>
<p>Having looked at the average effect of the intervention, we still do not yet know whether being seated next to each other also “works” for dissimilar students. Here, we will keep evaluating effects on the outcome scale, which we consider most intuitive. First, we can separately calculate average effects depending on gender_combination:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod, <span class="at">variables =</span> <span class="st">"deskmate"</span>, <span class="at">by =</span> <span class="st">"gender_combination"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<!-- preamble start -->

    <script>

      function styleCell_gwchls8dt3ldc3k5atxl(i, j, css_id) {
          var table = document.getElementById("tinytable_gwchls8dt3ldc3k5atxl");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_gwchls8dt3ldc3k5atxl');
        // Find the row with data-row attribute matching i
        var targetRow = table.querySelector(`tr [data-row="${i}"]`).closest('tr');
        var newRow = table.insertRow(targetRow.rowIndex);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        newCell.setAttribute("data-col", "0");
        newCell.setAttribute("data-row", i - 1);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_gwchls8dt3ldc3k5atxl(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_gwchls8dt3ldc3k5atxl");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '3', j: 0 }, { i: '3', j: 1 }, { i: '3', j: 2 }, { i: '3', j: 3 },  ], css_id: 'tinytable_css_slqttfbkel0fpgkudhm6',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 },  ], css_id: 'tinytable_css_1u6kq0gzzvlcghrlf2y8',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_gwchls8dt3ldc3k5atxl(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_slqttfbkel0fpgkudhm6, .table th.tinytable_css_slqttfbkel0fpgkudhm6 { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_1u6kq0gzzvlcghrlf2y8, .table th.tinytable_css_1u6kq0gzzvlcghrlf2y8 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_gwchls8dt3ldc3k5atxl" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">gender_combination</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">2.5 %</th>
                <th scope="col" data-row="0" data-col="3">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">Boys</td>
                  <td data-row="1" data-col="1">0.1683</td>
                  <td data-row="1" data-col="2">0.07489</td>
                  <td data-row="1" data-col="3">0.2675</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">Mixed</td>
                  <td data-row="2" data-col="1">0.0317</td>
                  <td data-row="2" data-col="2">0.00534</td>
                  <td data-row="2" data-col="3">0.0684</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="0">Girls</td>
                  <td data-row="3" data-col="1">0.1940</td>
                  <td data-row="3" data-col="2">0.08685</td>
                  <td data-row="3" data-col="3">0.3018</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<section id="pairwise-comparisons-e.g.-is-the-effect-of-sharing-a-desk-stronger-for-students-on-girls-only-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks" class="level4">
<h4 class="anchored" data-anchor-id="pairwise-comparisons-e.g.-is-the-effect-of-sharing-a-desk-stronger-for-students-on-girls-only-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks">Pairwise comparisons, e.g.: Is the effect of sharing a desk stronger for students on girls-only desks, relative to the effect of sharing a desk for students on mixed-gender desks?</h4>
<p>We can easily compare all three average effects against each other in a pairwise manner:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">variables =</span> <span class="st">"deskmate"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"gender_combination"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">hypothesis =</span> <span class="sc">~</span>pairwise)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<!-- preamble start -->

    <script>

      function styleCell_pkeoreoe8b2o122qxrqb(i, j, css_id) {
          var table = document.getElementById("tinytable_pkeoreoe8b2o122qxrqb");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_pkeoreoe8b2o122qxrqb');
        // Find the row with data-row attribute matching i
        var targetRow = table.querySelector(`tr [data-row="${i}"]`).closest('tr');
        var newRow = table.insertRow(targetRow.rowIndex);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        newCell.setAttribute("data-col", "0");
        newCell.setAttribute("data-row", i - 1);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_pkeoreoe8b2o122qxrqb(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_pkeoreoe8b2o122qxrqb");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '3', j: 0 }, { i: '3', j: 1 }, { i: '3', j: 2 }, { i: '3', j: 3 },  ], css_id: 'tinytable_css_cfe2grp5kg9iew81tehw',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 },  ], css_id: 'tinytable_css_tmzenql8vt4mjyaqb2u4',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_pkeoreoe8b2o122qxrqb(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_cfe2grp5kg9iew81tehw, .table th.tinytable_css_cfe2grp5kg9iew81tehw { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_tmzenql8vt4mjyaqb2u4, .table th.tinytable_css_tmzenql8vt4mjyaqb2u4 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_pkeoreoe8b2o122qxrqb" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Hypothesis</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">2.5 %</th>
                <th scope="col" data-row="0" data-col="3">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">(Mixed) - (Boys)</td>
                  <td data-row="1" data-col="1">-0.1355</td>
                  <td data-row="1" data-col="2">-0.2384</td>
                  <td data-row="1" data-col="3">-0.0346</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">(Girls) - (Boys)</td>
                  <td data-row="2" data-col="1">0.0273</td>
                  <td data-row="2" data-col="2">-0.1169</td>
                  <td data-row="2" data-col="3">0.1704</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="0">(Girls) - (Mixed)</td>
                  <td data-row="3" data-col="1">0.1607</td>
                  <td data-row="3" data-col="2">0.0441</td>
                  <td data-row="3" data-col="3">0.2760</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</section>
<section id="is-the-effect-of-sharing-a-desk-stronger-for-students-on-gender-matched-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks" class="level4">
<h4 class="anchored" data-anchor-id="is-the-effect-of-sharing-a-desk-stronger-for-students-on-gender-matched-desks-relative-to-the-effect-of-sharing-a-desk-for-students-on-mixed-gender-desks">Is the effect of sharing a desk stronger for students on gender-matched desks, relative to the effect of sharing a desk for students on mixed-gender desks?</h4>
<p>We may also want to compare gender-matched dyads (pairs of girls, pairs of boys) with gender-mismatched dyads (pairs of a girl and a boy), (b_Two girls + b_Two boys)/2 = b_One girl one boy. This can be achieved by using a different hypothesis argument (being mindful of the order in which the groups are listed in our output):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">variables =</span> <span class="st">"deskmate"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"gender_combination"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">hypothesis =</span> <span class="st">"(b1 + b3)/2 = b2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<!-- preamble start -->

    <script>

      function styleCell_s7zd01r7v4d4910wsao8(i, j, css_id) {
          var table = document.getElementById("tinytable_s7zd01r7v4d4910wsao8");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_s7zd01r7v4d4910wsao8');
        // Find the row with data-row attribute matching i
        var targetRow = table.querySelector(`tr [data-row="${i}"]`).closest('tr');
        var newRow = table.insertRow(targetRow.rowIndex);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        newCell.setAttribute("data-col", "0");
        newCell.setAttribute("data-row", i - 1);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_s7zd01r7v4d4910wsao8(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_s7zd01r7v4d4910wsao8");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 },  ], css_id: 'tinytable_css_gka9q5t1dlao6t2brhb5',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 },  ], css_id: 'tinytable_css_ex4g4nhc7hkwike3r8yr',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_s7zd01r7v4d4910wsao8(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_gka9q5t1dlao6t2brhb5, .table th.tinytable_css_gka9q5t1dlao6t2brhb5 { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_ex4g4nhc7hkwike3r8yr, .table th.tinytable_css_ex4g4nhc7hkwike3r8yr { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_s7zd01r7v4d4910wsao8" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Hypothesis</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">2.5 %</th>
                <th scope="col" data-row="0" data-col="3">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">(b1+b3)/2=b2</td>
                  <td data-row="1" data-col="1">0.149</td>
                  <td data-row="1" data-col="2">0.0667</td>
                  <td data-row="1" data-col="3">0.229</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</section>
<section id="plotting-the-effects-by-gender" class="level4">
<h4 class="anchored" data-anchor-id="plotting-the-effects-by-gender">Plotting the effects by gender</h4>
<p>We can also visualize these different effects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the predicted probabilities</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_predictions</span>(mod, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"gender_combination"</span>, <span class="st">"deskmate"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="deskmates_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the effects of the intervention in percentage points</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_comparisons</span>(mod, <span class="at">variables =</span> <span class="st">"deskmate"</span>, <span class="at">by =</span> <span class="st">"gender_combination"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="deskmates_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="averaging-over-vs.-conditioning-on-other-variables-in-the-model" class="level3">
<h3 class="anchored" data-anchor-id="averaging-over-vs.-conditioning-on-other-variables-in-the-model">Averaging Over vs.&nbsp;Conditioning on Other Variables in the Model</h3>
<p>Notice that so far, we have conducted counterfactual comparisons across deskmate and then simply averaged by gender_combination. In the counterfactual comparison step, we control for other variables in the model. But then when we average by gender_combination, we do not hold the other variables at any specific value – they simply naturally vary alongside gender_combination. Thus, when we compare the treatment effects between different gender_combinations, we compare them between groups that may also vary with respect to other variables, including those that are part of the model. One may think of these results as the unconditional association between gender_combination and the treatment effects. This is conceptually distinct from evaluating moderation by looking at model coefficients, since these coefficients are always conditional on all other predictors in the model. Thus, the default approach in the framework we champion differs from the default approach when interpreting coefficients, which warrants more discussion.</p>
<p>Should we condition on the other predictors in the model when evaluating moderation? First, this depends on what we are interested in – if we just want to know whether a third variable is associated with some treatment effect, there is no need to condition on other variables (unless we are explicitly interested in the conditional association for some reason). However, if we are interested in a causal interaction, it may be necessary to condition on third variables to account for confounding (for a more extensive discussion of the causal status of interactions, see <a href="https://journals.sagepub.com/doi/10.1177/25152459211007368#sec-3" target="_blank">Rohrer &amp; Arslan, 2021</a>)). Second, in the latter scenario, whether to condition on a variable or not will depend on whether it is a confounder of the causal interaction (in which case we should condition on it) rather than, for example, a mediator.</p>
<p>Recall that our model also contains GPA_difference. Pairs of students may vary in their GPA_difference, but these differences are plausibly causally downstream of gender_combination: For gender-mismatched dyads, we may observe larger differences in GPA because gender affects GPA (Gender combination → GPA difference → Effect of being seated next to each other). Thus, GPA_difference is a potential mediator of gender_combination and should not be conditioned on when evaluating whether gender_combination causally affects the effects of being seated next to each other. This vindicates our earlier analysis.</p>
<p>If we are interested in whether GPA_differences causally affect the effects of proximity, gender_combination is a confounder (GPA difference ← Gender combination → Effect of being seated next to each other). Thus, to evaluate the interaction between GPA_difference and Deskmate, we do want to condition gender_combination.</p>
<p>So, does the effect of being seated next to each other (deskmate) vary by how strong their academic achievement diverges (GPA_difference), controlling for the effects of gender match (gender_combination)? We can answer this question by conducting comparisons on new hypothetical datasets in which we set GPA_difference to particular values (e.g., ± 1 SD) but keep the other variables (including gender_match) as is.</p>
<section id="what-is-the-average-treatment-effect-of-sharing-a-desk-for-students-with-high-and-low-differences-in-gpa-accounting-for-gender" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-average-treatment-effect-of-sharing-a-desk-for-students-with-high-and-low-differences-in-gpa-accounting-for-gender">What is the average treatment effect of sharing a desk for students with high and low differences in GPA, accounting for gender?</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">variables =</span> <span class="st">"deskmate"</span>, <span class="co"># cause of interest</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"GPA_difference"</span>, <span class="co"># variable to split by</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">GPA_difference =</span> <span class="fu">c</span>(<span class="fu">mean</span>(dat<span class="sc">$</span>GPA_difference, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">sd</span>(dat<span class="sc">$</span>GPA_difference, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">mean</span>(dat<span class="sc">$</span>GPA_difference, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">sd</span>(dat<span class="sc">$</span>GPA_difference, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">grid_type =</span> <span class="st">"counterfactual"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<!-- preamble start -->

    <script>

      function styleCell_93jvjnzk5bg8obp2ooxn(i, j, css_id) {
          var table = document.getElementById("tinytable_93jvjnzk5bg8obp2ooxn");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_93jvjnzk5bg8obp2ooxn');
        // Find the row with data-row attribute matching i
        var targetRow = table.querySelector(`tr [data-row="${i}"]`).closest('tr');
        var newRow = table.insertRow(targetRow.rowIndex);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        newCell.setAttribute("data-col", "0");
        newCell.setAttribute("data-row", i - 1);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_93jvjnzk5bg8obp2ooxn(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_93jvjnzk5bg8obp2ooxn");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '2', j: 0 }, { i: '2', j: 1 }, { i: '2', j: 2 }, { i: '2', j: 3 },  ], css_id: 'tinytable_css_iuk6gwae6e0aaktp8gyp',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 },  ], css_id: 'tinytable_css_0jvgskavq84e627gfxnd',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_93jvjnzk5bg8obp2ooxn(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_iuk6gwae6e0aaktp8gyp, .table th.tinytable_css_iuk6gwae6e0aaktp8gyp { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_0jvgskavq84e627gfxnd, .table th.tinytable_css_0jvgskavq84e627gfxnd { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_93jvjnzk5bg8obp2ooxn" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">GPA_difference</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">2.5 %</th>
                <th scope="col" data-row="0" data-col="3">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">0.139</td>
                  <td data-row="1" data-col="1">0.1186</td>
                  <td data-row="1" data-col="2">0.0597</td>
                  <td data-row="1" data-col="3">0.182</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">1.504</td>
                  <td data-row="2" data-col="1">0.0973</td>
                  <td data-row="2" data-col="2">0.0375</td>
                  <td data-row="2" data-col="3">0.157</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the newdata argument is crucial here: we apply the model to new data which represents a counterfactual constrast</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># between a world in which everybody's GPA difference is set to 1 SD below the mean</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># and a world in which everybody's GPA difference is set to 1 SD above the mean.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the two estimates</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">variables =</span> <span class="st">"deskmate"</span>, <span class="co"># cause of interest</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="st">"GPA_difference"</span>, <span class="co"># variable to split by</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">GPA_difference =</span> <span class="fu">c</span>(<span class="fu">mean</span>(dat<span class="sc">$</span>GPA_difference, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">sd</span>(dat<span class="sc">$</span>GPA_difference, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">mean</span>(dat<span class="sc">$</span>GPA_difference, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">sd</span>(dat<span class="sc">$</span>GPA_difference, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">grid_type =</span> <span class="st">"counterfactual"</span>),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">hypothesis =</span> <span class="st">"b1 = b2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<!-- preamble start -->

    <script>

      function styleCell_32s0l68sy9qpawlpzqsp(i, j, css_id) {
          var table = document.getElementById("tinytable_32s0l68sy9qpawlpzqsp");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_32s0l68sy9qpawlpzqsp');
        // Find the row with data-row attribute matching i
        var targetRow = table.querySelector(`tr [data-row="${i}"]`).closest('tr');
        var newRow = table.insertRow(targetRow.rowIndex);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        newCell.setAttribute("data-col", "0");
        newCell.setAttribute("data-row", i - 1);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_32s0l68sy9qpawlpzqsp(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_32s0l68sy9qpawlpzqsp");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 },  ], css_id: 'tinytable_css_fl545tmdk4pb08ed9nr9',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 },  ], css_id: 'tinytable_css_y387unvvq9y8hml6f47j',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_32s0l68sy9qpawlpzqsp(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_fl545tmdk4pb08ed9nr9, .table th.tinytable_css_fl545tmdk4pb08ed9nr9 { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_y387unvvq9y8hml6f47j, .table th.tinytable_css_y387unvvq9y8hml6f47j { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_32s0l68sy9qpawlpzqsp" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Hypothesis</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">2.5 %</th>
                <th scope="col" data-row="0" data-col="3">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">b1=b2</td>
                  <td data-row="1" data-col="1">0.0212</td>
                  <td data-row="1" data-col="2">-0.0664</td>
                  <td data-row="1" data-col="3">0.116</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>