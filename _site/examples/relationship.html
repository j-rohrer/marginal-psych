<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>relationship – Models as Prediction Machines</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9d882aefbe6880e209bb4e231fcedeb2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Models as Prediction Machines</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assets/models_as_prediction_machines.zip"> 
<span class="menu-text">Replication package</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-examples" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Examples</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-examples">    
        <li>
    <a class="dropdown-item" href="../examples/relationship.html">
 <span class="dropdown-text">Relationship Status and Friends</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../examples/deskmates.html">
 <span class="dropdown-text">Friends by Chance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../examples/age.html">
 <span class="dropdown-text">Age Trajectories</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../examples/soep.html">
 <span class="dropdown-text">German Socio-Economic Panel Study</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#relationship-status-and-the-importance-of-friends" id="toc-relationship-status-and-the-importance-of-friends" class="nav-link active" data-scroll-target="#relationship-status-and-the-importance-of-friends">Relationship Status and the Importance of Friends</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#read-and-clean-the-data" id="toc-read-and-clean-the-data" class="nav-link" data-scroll-target="#read-and-clean-the-data">Read and clean the data</a></li>
  <li><a href="#visualize-associations-with-age" id="toc-visualize-associations-with-age" class="nav-link" data-scroll-target="#visualize-associations-with-age">Visualize associations with age</a></li>
  <li><a href="#model-fitting-and-interpretation-with-marginaleffects" id="toc-model-fitting-and-interpretation-with-marginaleffects" class="nav-link" data-scroll-target="#model-fitting-and-interpretation-with-marginaleffects">Model fitting and interpretation with <code>marginaleffects</code></a></li>
  <li><a href="#ordinal-robustness-check" id="toc-ordinal-robustness-check" class="nav-link" data-scroll-target="#ordinal-robustness-check">Ordinal robustness check</a></li>
  <li><a href="#varying-the-complexity-of-the-linear-model-to-see-what-happens" id="toc-varying-the-complexity-of-the-linear-model-to-see-what-happens" class="nav-link" data-scroll-target="#varying-the-complexity-of-the-linear-model-to-see-what-happens">Varying the complexity of the linear model to see what happens</a>
  <ul class="collapse">
  <li><a href="#age-variations" id="toc-age-variations" class="nav-link" data-scroll-target="#age-variations">Age variations</a></li>
  <li><a href="#interaction-variations" id="toc-interaction-variations" class="nav-link" data-scroll-target="#interaction-variations">Interaction variations</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="relationship-status-and-the-importance-of-friends" class="level1">
<h1>Relationship Status and the Importance of Friends</h1>
<p>Before we start, let’s execute <a href="https://github.com/j-rohrer/marginal-psych/blob/main/scripts/load.R">a helper script</a> that loads the necessary dependencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"scripts/load.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This document contains example 2, in which we analyze the association between relationship status and the importance people assign to friends. Data can be retrieved from the <a href="https://osf.io/gj6x5/files/osfstorage/63b81606c8da86094edf234b" target="_blank">OSF</a> but is also included in the downloadable replication package.</p>
<p>It’s a common complaint that people who enter a relationship start to neglect their friends. Here, we are going to use this to motivate an associational research question: Do people in romantic relationships, on average, assign less importance to their friends? To address this question, we analyze data that were collected in the context of a diary study on satisfaction with various aspects of life <a href="https://online.ucpress.edu/collabra/article/10/1/121238/202884/The-Effects-of-Satisfaction-With-Different-Domains" target="_blank">(Rohrer et al., 2024)</a>. In this study, 482 people reported whether they were in a romantic relationship of any kind (partner) and also the extent to which they considered their friendships important (friendship_importance) on a scale from 1 (not important at all) to 5 (very important).</p>
</section>
<section id="read-and-clean-the-data" class="level2">
<h2 class="anchored" data-anchor-id="read-and-clean-the-data">Read and clean the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data/start.csv"</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict to range that we can model well</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>sex <span class="sc">!=</span> <span class="dv">3</span>, ] <span class="co"># exclude 5 people who reported a gender distinct from male/female</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>age <span class="sc">&lt;</span> <span class="dv">60</span>, ] <span class="co"># exclude people over the age of 60</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit to complete cases</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[<span class="fu">complete.cases</span>(dat[, <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"partner_any"</span>, <span class="st">"IMP_friends_Start"</span>)]),]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(dat<span class="sc">$</span>sex)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the variables</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 
15 28 29 20 15 18 13 16 16 12  4 14  8  3  6  6 13 18 11  9 12 13  6  7 11  6  5  3 11 12 12  7 15 13 14  7  5 11  9 11 10  8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2 
347 135 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>partner_any)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
203 279 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename some variables</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">partner =</span> partner_any,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender =</span> sex,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">friendship_importance =</span> IMP_friends_Start)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualize-associations-with-age" class="level2">
<h2 class="anchored" data-anchor-id="visualize-associations-with-age">Visualize associations with age</h2>
<p>This code produces Figure 4: Predicted importance of friends by age in three different simple linear models that only include age as a predictor, including (1) age as a linear predictor or (2) age as a categorical predictor, or (3) age splines (B-splines with four degrees of freedom).</p>
<p>Respondents’ age varies from 18 to 59 years. How do we best include this variable in our analysis? If we simply include it as a linear predictor, we assume that friendship_importance changes with age in a linear manner. If, instead, we include it as a categorical predictor (treating each year of age as its own category), we do not impose any assumptions about the functional form—but for some years, we only have few observations, resulting in a trajectory that jumps around a lot, with wide confidence intervals.</p>
<p>So, we may prefer a solution that lies somewhere between these two options. Contenders may be using coarser age categories or using polynomials. A third alternative is splines. These result in flexible, locally smooth trajectories. Unlike polynomials, splines enforce no global functional forms; unlike age categories, splines do not result in abrupt jumps in the trajectory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear association</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>age_lin <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> age, <span class="at">data =</span> dat)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Each year of age as its own category</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>age_cat <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">as.factor</span>(age), <span class="at">data =</span> dat)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Smoothed with splines</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>age_smooth <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>), <span class="at">data =</span> dat)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions from each of the three models</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>pred_lin <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(age_lin, <span class="at">by =</span> <span class="st">"age"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>pred_cat <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(age_cat, <span class="at">by =</span> <span class="st">"age"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>pred_smooth <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(age_smooth, <span class="at">by =</span> <span class="st">"age"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The following code generates a grid that expands the categorical predictions</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># so that we can plot them as a step function including a step ribbon</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># (This is just to get the visuals of Figure 4 right and nothing substantive)</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>pred_cat_expanded <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(<span class="fu">rep</span>(pred_cat<span class="sc">$</span>estimate, <span class="at">each =</span> <span class="dv">100</span>)), <span class="at">ncol =</span> <span class="dv">4</span>))</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pred_cat_expanded) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"estimate"</span>, <span class="st">"conf.low"</span>, <span class="st">"conf.high"</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>pred_cat_expanded<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(pred_cat<span class="sc">$</span>age), <span class="at">to =</span> (<span class="fu">max</span>(pred_cat<span class="sc">$</span>age) <span class="sc">+</span> <span class="fl">0.999999</span>), <span class="at">length.out =</span> <span class="fu">nrow</span>(pred_cat_expanded))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>pred_cat_expanded<span class="sc">$</span>estimate <span class="ot">&lt;-</span> <span class="fu">rep</span>(pred_cat<span class="sc">$</span>estimate, <span class="at">each =</span> <span class="dv">100</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>pred_cat_expanded<span class="sc">$</span>conf.low <span class="ot">&lt;-</span> <span class="fu">rep</span>(pred_cat<span class="sc">$</span>conf.low, <span class="at">each =</span> <span class="dv">100</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>pred_cat_expanded<span class="sc">$</span>conf.high <span class="ot">&lt;-</span> <span class="fu">rep</span>(pred_cat<span class="sc">$</span>conf.high, <span class="at">each =</span> <span class="dv">100</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Color scheme for Figure 4</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>col_cat <span class="ot">&lt;-</span> <span class="st">"#E69F00"</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>col_lin <span class="ot">&lt;-</span> <span class="st">"#D55E00"</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>col_smooth <span class="ot">&lt;-</span> <span class="st">"#CC79A7"</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the plot</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># categorical</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_cat_expanded, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> estimate, <span class="at">group =</span> <span class="fu">floor</span>(age)), <span class="at">color =</span> col_cat) <span class="sc">+</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_cat_expanded, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), <span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">fill =</span> col_cat) <span class="sc">+</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_lin, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> estimate), <span class="at">color =</span> col_lin) <span class="sc">+</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_lin, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), <span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">fill =</span> col_lin) <span class="sc">+</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># smoothed</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_smooth, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> estimate), <span class="at">color =</span> col_smooth) <span class="sc">+</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_smooth, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), <span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">fill =</span> col_smooth) <span class="sc">+</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Importance of friends (95% CI)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="relationship_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(here("plots/age.png"), width = 4, height = 3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-fitting-and-interpretation-with-marginaleffects" class="level2">
<h2 class="anchored" data-anchor-id="model-fitting-and-interpretation-with-marginaleffects">Model fitting and interpretation with <code>marginaleffects</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions for a 20 year old single</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predictions</span>(mod, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">age =</span> <span class="dv">20</span>, <span class="at">gender =</span> <span class="st">"male"</span>, <span class="at">partner =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_bzbyyojv1ovxyv373l4e(i, j, css_id) {
          var table = document.getElementById("tinytable_bzbyyojv1ovxyv373l4e");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_bzbyyojv1ovxyv373l4e(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_bzbyyojv1ovxyv373l4e");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 }, { i: '1', j: 7 }, { i: '1', j: 8 }, { i: '1', j: 9 },  ], css_id: 'tinytable_css_wtaqccvygd72uyt1leel',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 }, { i: '0', j: 8 }, { i: '0', j: 9 },  ], css_id: 'tinytable_css_uwhxq8ylsx7842fvt6wh',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_bzbyyojv1ovxyv373l4e(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_wtaqccvygd72uyt1leel, .table th.tinytable_css_wtaqccvygd72uyt1leel { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_uwhxq8ylsx7842fvt6wh, .table th.tinytable_css_uwhxq8ylsx7842fvt6wh { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_bzbyyojv1ovxyv373l4e" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">age</th>
                <th scope="col" data-row="0" data-col="1">gender</th>
                <th scope="col" data-row="0" data-col="2">partner</th>
                <th scope="col" data-row="0" data-col="3">Estimate</th>
                <th scope="col" data-row="0" data-col="4">Std. Error</th>
                <th scope="col" data-row="0" data-col="5">z</th>
                <th scope="col" data-row="0" data-col="6">Pr(&gt;|z|)</th>
                <th scope="col" data-row="0" data-col="7">S</th>
                <th scope="col" data-row="0" data-col="8">2.5 %</th>
                <th scope="col" data-row="0" data-col="9">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">20</td>
                  <td data-row="1" data-col="1">male</td>
                  <td data-row="1" data-col="2">0</td>
                  <td data-row="1" data-col="3">4.66</td>
                  <td data-row="1" data-col="4">0.243</td>
                  <td data-row="1" data-col="5">19.2</td>
                  <td data-row="1" data-col="6">&lt;0.001</td>
                  <td data-row="1" data-col="7">269.4</td>
                  <td data-row="1" data-col="8">4.18</td>
                  <td data-row="1" data-col="9">5.13</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Slope of age for a 20 year old single</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">slopes</span>(mod, <span class="at">variables =</span> <span class="st">"age"</span>, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">age =</span> <span class="dv">20</span>, <span class="at">gender =</span> <span class="st">"male"</span>, <span class="at">partner =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_dt5gt7rgtetfvto4fhd7(i, j, css_id) {
          var table = document.getElementById("tinytable_dt5gt7rgtetfvto4fhd7");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_dt5gt7rgtetfvto4fhd7(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_dt5gt7rgtetfvto4fhd7");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 }, { i: '1', j: 7 }, { i: '1', j: 8 }, { i: '1', j: 9 },  ], css_id: 'tinytable_css_83a83qkn5w1rrlopjatt',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 }, { i: '0', j: 8 }, { i: '0', j: 9 },  ], css_id: 'tinytable_css_h817b7p7zxm6hfwultza',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_dt5gt7rgtetfvto4fhd7(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_83a83qkn5w1rrlopjatt, .table th.tinytable_css_83a83qkn5w1rrlopjatt { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_h817b7p7zxm6hfwultza, .table th.tinytable_css_h817b7p7zxm6hfwultza { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_dt5gt7rgtetfvto4fhd7" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">age</th>
                <th scope="col" data-row="0" data-col="1">gender</th>
                <th scope="col" data-row="0" data-col="2">partner</th>
                <th scope="col" data-row="0" data-col="3">Estimate</th>
                <th scope="col" data-row="0" data-col="4">Std. Error</th>
                <th scope="col" data-row="0" data-col="5">z</th>
                <th scope="col" data-row="0" data-col="6">Pr(&gt;|z|)</th>
                <th scope="col" data-row="0" data-col="7">S</th>
                <th scope="col" data-row="0" data-col="8">2.5 %</th>
                <th scope="col" data-row="0" data-col="9">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">20</td>
                  <td data-row="1" data-col="1">male</td>
                  <td data-row="1" data-col="2">0</td>
                  <td data-row="1" data-col="3">0.00329</td>
                  <td data-row="1" data-col="4">0.104</td>
                  <td data-row="1" data-col="5">0.0318</td>
                  <td data-row="1" data-col="6">0.975</td>
                  <td data-row="1" data-col="7">0.0</td>
                  <td data-row="1" data-col="8">-0.2</td>
                  <td data-row="1" data-col="9">0.207</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions for everybody in the data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predictions</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_ihs650ec1j6o0690yqhs(i, j, css_id) {
          var table = document.getElementById("tinytable_ihs650ec1j6o0690yqhs");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_ihs650ec1j6o0690yqhs(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_ihs650ec1j6o0690yqhs");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () { spanCell_ihs650ec1j6o0690yqhs(6, 0, 1, 7) })
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '11', j: 1 }, { i: '11', j: 0 }, { i: '11', j: 2 }, { i: '11', j: 5 }, { i: '11', j: 4 }, { i: '11', j: 3 }, { i: '11', j: 6 },  ], css_id: 'tinytable_css_7a67q5npili7d3m4iige',}, 
          { positions: [ { i: '6', j: 0 }, { i: '6', j: 1 }, { i: '6', j: 4 }, { i: '6', j: 3 }, { i: '6', j: 2 }, { i: '6', j: 5 }, { i: '6', j: 6 },  ], css_id: 'tinytable_css_8aomv9cd90c8emm4iw6k',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 3 }, { i: '0', j: 2 }, { i: '0', j: 1 }, { i: '0', j: 4 }, { i: '0', j: 6 }, { i: '0', j: 5 },  ], css_id: 'tinytable_css_rjxr0ayffadg0aayza6m',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_ihs650ec1j6o0690yqhs(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_7a67q5npili7d3m4iige, .table th.tinytable_css_7a67q5npili7d3m4iige { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_8aomv9cd90c8emm4iw6k, .table th.tinytable_css_8aomv9cd90c8emm4iw6k { text-align: center; }
      .table td.tinytable_css_rjxr0ayffadg0aayza6m, .table th.tinytable_css_rjxr0ayffadg0aayza6m { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_ihs650ec1j6o0690yqhs" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Estimate</th>
                <th scope="col" data-row="0" data-col="1">Std. Error</th>
                <th scope="col" data-row="0" data-col="2">z</th>
                <th scope="col" data-row="0" data-col="3">Pr(&gt;|z|)</th>
                <th scope="col" data-row="0" data-col="4">S</th>
                <th scope="col" data-row="0" data-col="5">2.5 %</th>
                <th scope="col" data-row="0" data-col="6">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">4.46</td>
                  <td data-row="1" data-col="1">0.1485</td>
                  <td data-row="1" data-col="2">30.0</td>
                  <td data-row="1" data-col="3">&lt;0.001</td>
                  <td data-row="1" data-col="4">654.5</td>
                  <td data-row="1" data-col="5">4.17</td>
                  <td data-row="1" data-col="6">4.75</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">4.58</td>
                  <td data-row="2" data-col="1">0.1362</td>
                  <td data-row="2" data-col="2">33.6</td>
                  <td data-row="2" data-col="3">&lt;0.001</td>
                  <td data-row="2" data-col="4">819.9</td>
                  <td data-row="2" data-col="5">4.31</td>
                  <td data-row="2" data-col="6">4.85</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="0">4.45</td>
                  <td data-row="3" data-col="1">0.1131</td>
                  <td data-row="3" data-col="2">39.3</td>
                  <td data-row="3" data-col="3">&lt;0.001</td>
                  <td data-row="3" data-col="4">Inf</td>
                  <td data-row="3" data-col="5">4.23</td>
                  <td data-row="3" data-col="6">4.67</td>
                </tr>
                <tr>
                  <td data-row="4" data-col="0">4.41</td>
                  <td data-row="4" data-col="1">0.0994</td>
                  <td data-row="4" data-col="2">44.4</td>
                  <td data-row="4" data-col="3">&lt;0.001</td>
                  <td data-row="4" data-col="4">Inf</td>
                  <td data-row="4" data-col="5">4.22</td>
                  <td data-row="4" data-col="6">4.61</td>
                </tr>
                <tr>
                  <td data-row="5" data-col="0">4.52</td>
                  <td data-row="5" data-col="1">0.1447</td>
                  <td data-row="5" data-col="2">31.2</td>
                  <td data-row="5" data-col="3">&lt;0.001</td>
                  <td data-row="5" data-col="4">709.7</td>
                  <td data-row="5" data-col="5">4.24</td>
                  <td data-row="5" data-col="6">4.81</td>
                </tr>
                <tr>
                  <td data-row="6" data-col="0">472 rows omitted</td>
                  <td data-row="6" data-col="1"></td>
                  <td data-row="6" data-col="2"></td>
                  <td data-row="6" data-col="3"></td>
                  <td data-row="6" data-col="4"></td>
                  <td data-row="6" data-col="5"></td>
                  <td data-row="6" data-col="6"></td>
                </tr>
                <tr>
                  <td data-row="7" data-col="0">4.66</td>
                  <td data-row="7" data-col="1">0.1341</td>
                  <td data-row="7" data-col="2">34.8</td>
                  <td data-row="7" data-col="3">&lt;0.001</td>
                  <td data-row="7" data-col="4">876.7</td>
                  <td data-row="7" data-col="5">4.40</td>
                  <td data-row="7" data-col="6">4.92</td>
                </tr>
                <tr>
                  <td data-row="8" data-col="0">4.63</td>
                  <td data-row="8" data-col="1">0.1872</td>
                  <td data-row="8" data-col="2">24.7</td>
                  <td data-row="8" data-col="3">&lt;0.001</td>
                  <td data-row="8" data-col="4">446.4</td>
                  <td data-row="8" data-col="5">4.26</td>
                  <td data-row="8" data-col="6">5.00</td>
                </tr>
                <tr>
                  <td data-row="9" data-col="0">4.46</td>
                  <td data-row="9" data-col="1">0.1480</td>
                  <td data-row="9" data-col="2">30.1</td>
                  <td data-row="9" data-col="3">&lt;0.001</td>
                  <td data-row="9" data-col="4">659.1</td>
                  <td data-row="9" data-col="5">4.17</td>
                  <td data-row="9" data-col="6">4.75</td>
                </tr>
                <tr>
                  <td data-row="10" data-col="0">4.46</td>
                  <td data-row="10" data-col="1">0.1480</td>
                  <td data-row="10" data-col="2">30.1</td>
                  <td data-row="10" data-col="3">&lt;0.001</td>
                  <td data-row="10" data-col="4">659.1</td>
                  <td data-row="10" data-col="5">4.17</td>
                  <td data-row="10" data-col="6">4.75</td>
                </tr>
                <tr>
                  <td data-row="11" data-col="0">4.67</td>
                  <td data-row="11" data-col="1">0.1104</td>
                  <td data-row="11" data-col="2">42.2</td>
                  <td data-row="11" data-col="3">&lt;0.001</td>
                  <td data-row="11" data-col="4">Inf</td>
                  <td data-row="11" data-col="5">4.45</td>
                  <td data-row="11" data-col="6">4.88</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Main result: Difference in friendship importance with and without partner, holding constant age and gender</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod, <span class="at">variables =</span> <span class="st">"partner"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_fcojomh56vjzhy560c5r(i, j, css_id) {
          var table = document.getElementById("tinytable_fcojomh56vjzhy560c5r");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_fcojomh56vjzhy560c5r(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_fcojomh56vjzhy560c5r");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 },  ], css_id: 'tinytable_css_4d947seh61sb0qu8bd6v',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 },  ], css_id: 'tinytable_css_333zndmxr7jz6js0ycfq',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_fcojomh56vjzhy560c5r(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_4d947seh61sb0qu8bd6v, .table th.tinytable_css_4d947seh61sb0qu8bd6v { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_333zndmxr7jz6js0ycfq, .table th.tinytable_css_333zndmxr7jz6js0ycfq { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_fcojomh56vjzhy560c5r" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Estimate</th>
                <th scope="col" data-row="0" data-col="1">Std. Error</th>
                <th scope="col" data-row="0" data-col="2">z</th>
                <th scope="col" data-row="0" data-col="3">Pr(&gt;|z|)</th>
                <th scope="col" data-row="0" data-col="4">S</th>
                <th scope="col" data-row="0" data-col="5">2.5 %</th>
                <th scope="col" data-row="0" data-col="6">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">-0.072</td>
                  <td data-row="1" data-col="1">0.0804</td>
                  <td data-row="1" data-col="2">-0.896</td>
                  <td data-row="1" data-col="3">0.37</td>
                  <td data-row="1" data-col="4">1.4</td>
                  <td data-row="1" data-col="5">-0.23</td>
                  <td data-row="1" data-col="6">0.0856</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate separate estimates of the difference, by gender</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod, <span class="at">variables =</span> <span class="st">"partner"</span>, <span class="at">by =</span> <span class="st">"gender"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_rsdlrbpho1vy91sxtuz9(i, j, css_id) {
          var table = document.getElementById("tinytable_rsdlrbpho1vy91sxtuz9");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_rsdlrbpho1vy91sxtuz9(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_rsdlrbpho1vy91sxtuz9");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '2', j: 0 }, { i: '2', j: 1 }, { i: '2', j: 2 }, { i: '2', j: 3 }, { i: '2', j: 4 }, { i: '2', j: 5 }, { i: '2', j: 6 }, { i: '2', j: 7 },  ], css_id: 'tinytable_css_xe2xx0kksfvy3v7eh59n',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 },  ], css_id: 'tinytable_css_4qzxh5g5dpcshrwtmjoe',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_rsdlrbpho1vy91sxtuz9(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_xe2xx0kksfvy3v7eh59n, .table th.tinytable_css_xe2xx0kksfvy3v7eh59n { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_4qzxh5g5dpcshrwtmjoe, .table th.tinytable_css_4qzxh5g5dpcshrwtmjoe { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_rsdlrbpho1vy91sxtuz9" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">gender</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">Std. Error</th>
                <th scope="col" data-row="0" data-col="3">z</th>
                <th scope="col" data-row="0" data-col="4">Pr(&gt;|z|)</th>
                <th scope="col" data-row="0" data-col="5">S</th>
                <th scope="col" data-row="0" data-col="6">2.5 %</th>
                <th scope="col" data-row="0" data-col="7">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">female</td>
                  <td data-row="1" data-col="1">-0.0738</td>
                  <td data-row="1" data-col="2">0.0946</td>
                  <td data-row="1" data-col="3">-0.780</td>
                  <td data-row="1" data-col="4">0.436</td>
                  <td data-row="1" data-col="5">1.2</td>
                  <td data-row="1" data-col="6">-0.259</td>
                  <td data-row="1" data-col="7">0.112</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">male</td>
                  <td data-row="2" data-col="1">-0.0675</td>
                  <td data-row="2" data-col="2">0.1529</td>
                  <td data-row="2" data-col="3">-0.442</td>
                  <td data-row="2" data-col="4">0.659</td>
                  <td data-row="2" data-col="5">0.6</td>
                  <td data-row="2" data-col="6">-0.367</td>
                  <td data-row="2" data-col="7">0.232</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare these gender-specific estimates</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod, <span class="at">variables =</span> <span class="st">"partner"</span>, <span class="at">by =</span> <span class="st">"gender"</span>, <span class="at">hypothesis =</span> <span class="st">"b2 - b1 = 0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_zruxy7v0deb8mk290agg(i, j, css_id) {
          var table = document.getElementById("tinytable_zruxy7v0deb8mk290agg");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_zruxy7v0deb8mk290agg(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_zruxy7v0deb8mk290agg");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 }, { i: '1', j: 7 },  ], css_id: 'tinytable_css_61qtwn8nwjsgcxowe6ha',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 },  ], css_id: 'tinytable_css_dfh4rv2tjm0qpsyzo4x7',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_zruxy7v0deb8mk290agg(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_61qtwn8nwjsgcxowe6ha, .table th.tinytable_css_61qtwn8nwjsgcxowe6ha { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_dfh4rv2tjm0qpsyzo4x7, .table th.tinytable_css_dfh4rv2tjm0qpsyzo4x7 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_zruxy7v0deb8mk290agg" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Hypothesis</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">Std. Error</th>
                <th scope="col" data-row="0" data-col="3">z</th>
                <th scope="col" data-row="0" data-col="4">Pr(&gt;|z|)</th>
                <th scope="col" data-row="0" data-col="5">S</th>
                <th scope="col" data-row="0" data-col="6">2.5 %</th>
                <th scope="col" data-row="0" data-col="7">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">b2-b1=0</td>
                  <td data-row="1" data-col="1">0.00625</td>
                  <td data-row="1" data-col="2">0.18</td>
                  <td data-row="1" data-col="3">0.0348</td>
                  <td data-row="1" data-col="4">0.972</td>
                  <td data-row="1" data-col="5">0.0</td>
                  <td data-row="1" data-col="6">-0.346</td>
                  <td data-row="1" data-col="7">0.359</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For the sake of completeness, we may also generate age-specific estimates</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the wiggliness of this line will depend on how we modeled age</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod, <span class="at">variables =</span> <span class="st">"partner"</span>, <span class="at">by =</span> <span class="st">"age"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comp, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Association partner and friendship importance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="relationship_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ordinal-robustness-check" class="level2">
<h2 class="anchored" data-anchor-id="ordinal-robustness-check">Ordinal robustness check</h2>
<p>So far, we have simply conducted linear regressions, but that may be considered suspect given the nature of the outcome: it’s just a five-point response scale ranging from not important at all to very important. And, in fact, barely anybody used the lower response options—more than 40% picked the highest response option. This results in a distribution for which the assumptions of linear regression may be considered heroic.</p>
<p>So, let’s run an ordinal regression to see whether conclusions change. Here, we are going to fit a cumulative ordinal model with a probit link using the ordinal package <a href="https://cran.r-project.org/web/packages/ordinal/index.html" target="_blank">(Christensen, 2023)</a> using the clm() function. In essence, this approach assumes a continuous, normally distributed standardized latent variable (“true” friendship_importance) which is translated into the ordinal response variable following thresholds that are estimated from the data; for example, people who score -3 or less on the standardized latent variable may report that their friends are not important at all, people who score more than that but below -2.7 may pick the second lowest response option, and so on (see <a href="https://journals.sagepub.com/doi/10.1177/2515245918823199" target="_blank">Bürkner &amp; Vuorre, 2019</a> for a proper introduction to these models).</p>
<p>The rest of the model specification remains unchanged:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome as factor variable which is what clm() expects</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>friendship_importance_factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat<span class="sc">$</span>friendship_importance, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>mod_ord <span class="ot">&lt;-</span> <span class="fu">clm</span>(friendship_importance_factor <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>partner, </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> dat,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">link =</span> <span class="st">"probit"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate central comparison in terms of change in response probabilities</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod_ord, <span class="at">variables =</span> <span class="st">"partner"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_3hy2xa7xc8cxj7xvz5o2(i, j, css_id) {
          var table = document.getElementById("tinytable_3hy2xa7xc8cxj7xvz5o2");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_3hy2xa7xc8cxj7xvz5o2(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_3hy2xa7xc8cxj7xvz5o2");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '5', j: 0 }, { i: '5', j: 1 }, { i: '5', j: 2 }, { i: '5', j: 3 }, { i: '5', j: 4 }, { i: '5', j: 5 }, { i: '5', j: 6 }, { i: '5', j: 7 },  ], css_id: 'tinytable_css_pjfd1xiithkv9rlcx85w',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 },  ], css_id: 'tinytable_css_dnycanicjl1iekr56q5u',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_3hy2xa7xc8cxj7xvz5o2(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_pjfd1xiithkv9rlcx85w, .table th.tinytable_css_pjfd1xiithkv9rlcx85w { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_dnycanicjl1iekr56q5u, .table th.tinytable_css_dnycanicjl1iekr56q5u { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_3hy2xa7xc8cxj7xvz5o2" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Group</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">Std. Error</th>
                <th scope="col" data-row="0" data-col="3">z</th>
                <th scope="col" data-row="0" data-col="4">Pr(&gt;|z|)</th>
                <th scope="col" data-row="0" data-col="5">S</th>
                <th scope="col" data-row="0" data-col="6">2.5 %</th>
                <th scope="col" data-row="0" data-col="7">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">1</td>
                  <td data-row="1" data-col="1">0.00170</td>
                  <td data-row="1" data-col="2">0.00436</td>
                  <td data-row="1" data-col="3">0.390</td>
                  <td data-row="1" data-col="4">0.6963</td>
                  <td data-row="1" data-col="5">0.5</td>
                  <td data-row="1" data-col="6">-0.00685</td>
                  <td data-row="1" data-col="7">0.0103</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">2</td>
                  <td data-row="2" data-col="1">0.00353</td>
                  <td data-row="2" data-col="2">0.00555</td>
                  <td data-row="2" data-col="3">0.636</td>
                  <td data-row="2" data-col="4">0.5247</td>
                  <td data-row="2" data-col="5">0.9</td>
                  <td data-row="2" data-col="6">-0.00735</td>
                  <td data-row="2" data-col="7">0.0144</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="0">3</td>
                  <td data-row="3" data-col="1">0.02129</td>
                  <td data-row="3" data-col="2">0.01963</td>
                  <td data-row="3" data-col="3">1.085</td>
                  <td data-row="3" data-col="4">0.2780</td>
                  <td data-row="3" data-col="5">1.8</td>
                  <td data-row="3" data-col="6">-0.01718</td>
                  <td data-row="3" data-col="7">0.0598</td>
                </tr>
                <tr>
                  <td data-row="4" data-col="0">4</td>
                  <td data-row="4" data-col="1">0.02896</td>
                  <td data-row="4" data-col="2">0.01641</td>
                  <td data-row="4" data-col="3">1.765</td>
                  <td data-row="4" data-col="4">0.0776</td>
                  <td data-row="4" data-col="5">3.7</td>
                  <td data-row="4" data-col="6">-0.00320</td>
                  <td data-row="4" data-col="7">0.0611</td>
                </tr>
                <tr>
                  <td data-row="5" data-col="0">5</td>
                  <td data-row="5" data-col="1">-0.05549</td>
                  <td data-row="5" data-col="2">0.03847</td>
                  <td data-row="5" data-col="3">-1.442</td>
                  <td data-row="5" data-col="4">0.1492</td>
                  <td data-row="5" data-col="5">2.7</td>
                  <td data-row="5" data-col="6">-0.13089</td>
                  <td data-row="5" data-col="7">0.0199</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># these results seem reasonable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s hard to compare these results to the results from the linear model. If one really wants to generate an estimate that is as comparable as possible, one can assign integer values from 1 to 5 to the response categories and thus estimate what the ordinal model implies for the average:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the response probabilities and attach the integers 1:5 to the consecutive</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># response categories to arrive at the same metric as the linear model</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod_ord, <span class="at">variables =</span> <span class="st">"partner"</span>, <span class="at">hypothesis =</span> <span class="sc">~</span> <span class="fu">I</span>(<span class="fu">sum</span>(x <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_q9b6zw7r9tob39qywbz3(i, j, css_id) {
          var table = document.getElementById("tinytable_q9b6zw7r9tob39qywbz3");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_q9b6zw7r9tob39qywbz3(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_q9b6zw7r9tob39qywbz3");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 }, { i: '1', j: 3 }, { i: '1', j: 4 }, { i: '1', j: 5 }, { i: '1', j: 6 },  ], css_id: 'tinytable_css_2h4rc639ycbtvdkoq2ig',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 },  ], css_id: 'tinytable_css_pjd3y5t1t06ikp9ogm8c',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_q9b6zw7r9tob39qywbz3(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_2h4rc639ycbtvdkoq2ig, .table th.tinytable_css_2h4rc639ycbtvdkoq2ig { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_pjd3y5t1t06ikp9ogm8c, .table th.tinytable_css_pjd3y5t1t06ikp9ogm8c { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_q9b6zw7r9tob39qywbz3" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Estimate</th>
                <th scope="col" data-row="0" data-col="1">Std. Error</th>
                <th scope="col" data-row="0" data-col="2">z</th>
                <th scope="col" data-row="0" data-col="3">Pr(&gt;|z|)</th>
                <th scope="col" data-row="0" data-col="4">S</th>
                <th scope="col" data-row="0" data-col="5">2.5 %</th>
                <th scope="col" data-row="0" data-col="6">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">-0.089</td>
                  <td data-row="1" data-col="1">0.0784</td>
                  <td data-row="1" data-col="2">-1.13</td>
                  <td data-row="1" data-col="3">0.257</td>
                  <td data-row="1" data-col="4">2.0</td>
                  <td data-row="1" data-col="5">-0.243</td>
                  <td data-row="1" data-col="6">0.0647</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>This makes use of the hypothesis argument, which allows researchers to conduct tests on arbitrary transformations of the quantities of interest. Here, we take each row of the standard output (the change in the probability of a given response option with partner), multiply it with the corresponding integer value (1 to 5), and sum everything up.</p>
<p>While this ensures that we ask the ordinal model precisely the same answer that we asked the linear model, it may appear a bit inconsistent given that we usually use ordinal models precisely because we don’t want to assign integer values to the response categories – although note that here we do it only in the very last step, so the model itself does not assume that the distances between adjacent response categories are the same.</p>
<p>Much more in the spirit of the ordinal model, we can also compute the effect on the underlying continuous variable that the model assumes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate effect on the underlying latent variable</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod_ord, <span class="at">variables =</span> <span class="st">"partner"</span>, <span class="at">type =</span> <span class="st">"linear.predictor"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_btc2t67dv9h55o9i37bi(i, j, css_id) {
          var table = document.getElementById("tinytable_btc2t67dv9h55o9i37bi");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_btc2t67dv9h55o9i37bi(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_btc2t67dv9h55o9i37bi");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '5', j: 0 }, { i: '5', j: 1 }, { i: '5', j: 2 }, { i: '5', j: 3 }, { i: '5', j: 4 }, { i: '5', j: 5 }, { i: '5', j: 6 }, { i: '5', j: 7 },  ], css_id: 'tinytable_css_z8i5hl2gftidhds740at',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 }, { i: '0', j: 6 }, { i: '0', j: 7 },  ], css_id: 'tinytable_css_d6rjpl44gxl1o8x594ot',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_btc2t67dv9h55o9i37bi(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_z8i5hl2gftidhds740at, .table th.tinytable_css_z8i5hl2gftidhds740at { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_d6rjpl44gxl1o8x594ot, .table th.tinytable_css_d6rjpl44gxl1o8x594ot { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_btc2t67dv9h55o9i37bi" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Group</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">Std. Error</th>
                <th scope="col" data-row="0" data-col="3">z</th>
                <th scope="col" data-row="0" data-col="4">Pr(&gt;|z|)</th>
                <th scope="col" data-row="0" data-col="5">S</th>
                <th scope="col" data-row="0" data-col="6">2.5 %</th>
                <th scope="col" data-row="0" data-col="7">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">1</td>
                  <td data-row="1" data-col="1">0.147</td>
                  <td data-row="1" data-col="2">0.107</td>
                  <td data-row="1" data-col="3">1.38</td>
                  <td data-row="1" data-col="4">0.169</td>
                  <td data-row="1" data-col="5">2.6</td>
                  <td data-row="1" data-col="6">-0.0623</td>
                  <td data-row="1" data-col="7">0.355</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">2</td>
                  <td data-row="2" data-col="1">0.147</td>
                  <td data-row="2" data-col="2">0.107</td>
                  <td data-row="2" data-col="3">1.38</td>
                  <td data-row="2" data-col="4">0.169</td>
                  <td data-row="2" data-col="5">2.6</td>
                  <td data-row="2" data-col="6">-0.0623</td>
                  <td data-row="2" data-col="7">0.355</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="0">3</td>
                  <td data-row="3" data-col="1">0.147</td>
                  <td data-row="3" data-col="2">0.107</td>
                  <td data-row="3" data-col="3">1.38</td>
                  <td data-row="3" data-col="4">0.169</td>
                  <td data-row="3" data-col="5">2.6</td>
                  <td data-row="3" data-col="6">-0.0623</td>
                  <td data-row="3" data-col="7">0.355</td>
                </tr>
                <tr>
                  <td data-row="4" data-col="0">4</td>
                  <td data-row="4" data-col="1">0.147</td>
                  <td data-row="4" data-col="2">0.107</td>
                  <td data-row="4" data-col="3">1.38</td>
                  <td data-row="4" data-col="4">0.169</td>
                  <td data-row="4" data-col="5">2.6</td>
                  <td data-row="4" data-col="6">-0.0623</td>
                  <td data-row="4" data-col="7">0.355</td>
                </tr>
                <tr>
                  <td data-row="5" data-col="0">5</td>
                  <td data-row="5" data-col="1">0.147</td>
                  <td data-row="5" data-col="2">0.107</td>
                  <td data-row="5" data-col="3">1.37</td>
                  <td data-row="5" data-col="4">0.170</td>
                  <td data-row="5" data-col="5">2.6</td>
                  <td data-row="5" data-col="6">-0.0627</td>
                  <td data-row="5" data-col="7">0.356</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>friendship_importance_factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat<span class="sc">$</span>friendship_importance, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>mod_ord <span class="ot">&lt;-</span> <span class="fu">clm</span>(friendship_importance_factor <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>partner, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> dat,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">link =</span> <span class="st">"probit"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>d0 <span class="ot">&lt;-</span> <span class="fu">transform</span>(dat, <span class="at">partner =</span> <span class="dv">0</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">transform</span>(dat, <span class="at">partner =</span> <span class="dv">1</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_ord, <span class="at">newdata =</span> d0, <span class="at">type =</span> <span class="st">"linear.predictor"</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_ord, <span class="at">newdata =</span> d1, <span class="at">type =</span> <span class="st">"linear.predictor"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(p1<span class="sc">$</span>eta1 <span class="sc">-</span> p0<span class="sc">$</span>eta1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1465469</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: This currently returns the wrong sign. Bug to be fixed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="bayesian-ordinal-regression" class="level4">
<h4 class="anchored" data-anchor-id="bayesian-ordinal-regression">Bayesian ordinal regression</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>mod_ord_brm <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>            friendship_importance_factor <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>partner,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> dat,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">link =</span> <span class="st">"probit"</span>), </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">4000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod_ord_brm, <span class="at">variables =</span> <span class="st">"partner"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_melizygp0ky19wkzs5re(i, j, css_id) {
          var table = document.getElementById("tinytable_melizygp0ky19wkzs5re");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_melizygp0ky19wkzs5re(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_melizygp0ky19wkzs5re");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '5', j: 0 }, { i: '5', j: 1 }, { i: '5', j: 2 }, { i: '5', j: 3 },  ], css_id: 'tinytable_css_6nefaghm15a8ndof39to',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 }, { i: '0', j: 3 },  ], css_id: 'tinytable_css_ybjukez0xxkfmy93czy4',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_melizygp0ky19wkzs5re(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_6nefaghm15a8ndof39to, .table th.tinytable_css_6nefaghm15a8ndof39to { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_ybjukez0xxkfmy93czy4, .table th.tinytable_css_ybjukez0xxkfmy93czy4 { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_melizygp0ky19wkzs5re" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Group</th>
                <th scope="col" data-row="0" data-col="1">Estimate</th>
                <th scope="col" data-row="0" data-col="2">2.5 %</th>
                <th scope="col" data-row="0" data-col="3">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">1</td>
                  <td data-row="1" data-col="1">0.00132</td>
                  <td data-row="1" data-col="2">-0.00798</td>
                  <td data-row="1" data-col="3">0.0115</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="0">2</td>
                  <td data-row="2" data-col="1">0.00338</td>
                  <td data-row="2" data-col="2">-0.00757</td>
                  <td data-row="2" data-col="3">0.0156</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="0">3</td>
                  <td data-row="3" data-col="1">0.02108</td>
                  <td data-row="3" data-col="2">-0.01542</td>
                  <td data-row="3" data-col="3">0.0597</td>
                </tr>
                <tr>
                  <td data-row="4" data-col="0">4</td>
                  <td data-row="4" data-col="1">0.02925</td>
                  <td data-row="4" data-col="2">-0.00152</td>
                  <td data-row="4" data-col="3">0.0613</td>
                </tr>
                <tr>
                  <td data-row="5" data-col="0">5</td>
                  <td data-row="5" data-col="1">-0.05541</td>
                  <td data-row="5" data-col="2">-0.13218</td>
                  <td data-row="5" data-col="3">0.0181</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_comparisons</span>(mod_ord_brm, <span class="at">variables =</span> <span class="st">"partner"</span>, <span class="at">type =</span> <span class="st">"link"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_5k1zp6nwa2opzbcr400r(i, j, css_id) {
          var table = document.getElementById("tinytable_5k1zp6nwa2opzbcr400r");
          var cell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function spanCell_5k1zp6nwa2opzbcr400r(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_5k1zp6nwa2opzbcr400r");
        const targetCell = table.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (!targetCell) {
          console.warn(`Cell at (${i}, ${j}) not found.`);
        }

        // Get all cells that need to be removed
        const cellsToRemove = [];
        for (let r = 0; r < rowspan; r++) {
          for (let c = 0; c < colspan; c++) {
            if (r === 0 && c === 0) continue; // Skip the target cell
            const cell = table.querySelector(`[data-row="${i + r}"][data-col="${j + c}"]`);
            if (cell) {
              cellsToRemove.push(cell);
            }
          }
        }

        // Remove all cells
        cellsToRemove.forEach(cell => cell.remove());

        // Set rowspan and colspan of the target cell if it exists
        if (targetCell) {
          targetCell.rowSpan = rowspan;
          targetCell.colSpan = colspan;
        }
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '1', j: 0 }, { i: '1', j: 1 }, { i: '1', j: 2 },  ], css_id: 'tinytable_css_vjstprvwdi1ro3fsnx6v',}, 
          { positions: [ { i: '0', j: 0 }, { i: '0', j: 1 }, { i: '0', j: 2 },  ], css_id: 'tinytable_css_8mh9fseagvtdpvy9nlua',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_5k1zp6nwa2opzbcr400r(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_vjstprvwdi1ro3fsnx6v, .table th.tinytable_css_vjstprvwdi1ro3fsnx6v { border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_8mh9fseagvtdpvy9nlua, .table th.tinytable_css_8mh9fseagvtdpvy9nlua { border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_5k1zp6nwa2opzbcr400r" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col" data-row="0" data-col="0">Estimate</th>
                <th scope="col" data-row="0" data-col="1">2.5 %</th>
                <th scope="col" data-row="0" data-col="2">97.5 %</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td data-row="1" data-col="0">-0.148</td>
                  <td data-row="1" data-col="1">-0.364</td>
                  <td data-row="1" data-col="2">0.057</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</section>
</section>
<section id="varying-the-complexity-of-the-linear-model-to-see-what-happens" class="level2">
<h2 class="anchored" data-anchor-id="varying-the-complexity-of-the-linear-model-to-see-what-happens">Varying the complexity of the linear model to see what happens</h2>
<p>Let’s vary model complexity to see what happens to our target quantity, the association between having a partner and friendship importance (holding constant age and gender).</p>
<section id="age-variations" class="level3">
<h3 class="anchored" data-anchor-id="age-variations">Age variations</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No age in the model</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>mod_age_0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>            partner<span class="sc">:</span>gender, <span class="at">data =</span> dat)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>comp_age_0 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_0, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>comp_age_0<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Not included"</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear age in the model</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>mod_age_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>            age<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> age<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>comp_age_1 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_1, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>comp_age_1<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Linear"</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic age on top</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>mod_age_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">2</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">poly</span>(age, <span class="dv">2</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">poly</span>(age, <span class="dv">2</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>comp_age_2 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_2, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>comp_age_2<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Quadratic"</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Cubic age on top</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>mod_age_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">3</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">poly</span>(age, <span class="dv">3</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">poly</span>(age, <span class="dv">3</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>comp_age_3 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_3, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>comp_age_3<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Cubic"</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Quartic age on tope</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>mod_age_4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">4</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">poly</span>(age, <span class="dv">4</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">poly</span>(age, <span class="dv">4</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>comp_age_4 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_4, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>comp_age_4<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Quartic"</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Quintic age on tope</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>mod_age_5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">5</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">poly</span>(age, <span class="dv">5</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">poly</span>(age, <span class="dv">5</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>comp_age_5 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_4, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>comp_age_5<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Quintic"</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Age with splines, df = 3</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>mod_age_6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">3</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">3</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">3</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>comp_age_6 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_6, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>comp_age_6<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Splines, df = 3"</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines, df = 4 (same as model reported in main text)</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>mod_age_7 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">3</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">3</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>comp_age_7 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_7, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>comp_age_7<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Splines, df = 4"</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines, df = 5</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>mod_age_8 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">5</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">5</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>comp_age_8 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_8, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>comp_age_8<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Splines, df = 5"</span></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Splines, df = 6</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>mod_age_9 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">6</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">6</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">6</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>comp_age_9 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_age_8, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>comp_age_9<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Splines, df = 6"</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Put all the comparisons from the different model</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a><span class="co"># into one dataframe for plotting purposes</span></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>comp_age <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">data.frame</span>(comp_age_0), <span class="fu">data.frame</span>(comp_age_1), </span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">data.frame</span>(comp_age_2), <span class="fu">data.frame</span>(comp_age_3),</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">data.frame</span>(comp_age_4), <span class="fu">data.frame</span>(comp_age_5),</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">data.frame</span>(comp_age_6), <span class="fu">data.frame</span>(comp_age_7),</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">data.frame</span>(comp_age_8), <span class="fu">data.frame</span>(comp_age_9))</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Numbering (for plotting purposes)</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>comp_age<span class="sc">$</span>no <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(comp_age)</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the plot</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comp_age, <span class="fu">aes</span>(<span class="at">x =</span> no, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>() <span class="sc">+</span></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> comp_age<span class="sc">$</span>no, <span class="at">labels =</span> comp_age<span class="sc">$</span>model) <span class="sc">+</span></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Way that age is included in model"</span>) <span class="sc">+</span></span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Target quantity (95% CI)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="relationship_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(here("plots/age_robustness.png"), width = 4, height = 3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="interaction-variations" class="level3">
<h3 class="anchored" data-anchor-id="interaction-variations">Interaction variations</h3>
<p>Let’s see whether the inclusion of interactions makes a difference</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No interactions</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>mod_interact_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner, <span class="at">data =</span> dat)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>comp_interact_1 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_interact_1, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>comp_interact_1<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"No interaction"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add two-way interactions (same as model reported in main text)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>mod_interact_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> gender <span class="sc">+</span> partner <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>gender <span class="sc">+</span> partner<span class="sc">:</span>gender <span class="sc">+</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">:</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>comp_interact_2 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_interact_2, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>comp_interact_2<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Two-way interactions"</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add three-way interaction</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>mod_interact_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(friendship_importance <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">4</span>)<span class="sc">*</span>gender<span class="sc">*</span>partner, <span class="at">data =</span> dat)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>comp_interact_3 <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(mod_interact_3, <span class="at">variables =</span> <span class="st">"partner"</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>comp_interact_3<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"Three-way interaction"</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Put all the comparisons from the different model</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># into one dataframe for plotting purposes</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>comp_interact <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">data.frame</span>(comp_interact_1), <span class="fu">data.frame</span>(comp_interact_2), <span class="fu">data.frame</span>(comp_interact_3))</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Numbering (for plotting purposes)</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>comp_interact<span class="sc">$</span>no <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(comp_interact)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the results</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comp_interact, <span class="fu">aes</span>(<span class="at">x =</span> no, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>() <span class="sc">+</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>, <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> comp_interact<span class="sc">$</span>no, <span class="at">labels =</span> comp_interact<span class="sc">$</span>model) <span class="sc">+</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Interactions included"</span>) <span class="sc">+</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimated difference in friendship importance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="relationship_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>